$(function(){var jqoForm=$("form.novoAnuncio");var jqoWarning=$(".chooseCultura .warningMessage");var jqoConfirmBtn=$("#btnConfirmar");var jqoWarningBox=$(".statusMessage");var _isLoading=!1;var varieId=!1;var trocaVarieId=!1;var _initChooseCultura=function(jqoChooseCultura,isTroca){var jqoVariedInp=$(".inpCultivar",jqoChooseCultura);var jqoSearchBtn=$(".actionBtn a",jqoChooseCultura);var _searchTimer=!1;var _delayedSearch=function(){if(_searchTimer){clearTimeout(_searchTimer)}
_searchTimer=setTimeout(_searchVariedade,75)};var _disableVariedade=function(yesno){if(yesno){jqoVariedInp.prop('readonly',!0).css('background','#DDD').blur();jqoSearchBtn.css('display','inline-block').outerWidth(jqoSearchBtn.outerWidth()).css('text-align','center').html("<i class='fa fa-spinner fa-spin'></i>")}
else{jqoVariedInp.prop('readonly',!1).css('background','');jqoSearchBtn.css('display','inline-block').outerWidth(jqoSearchBtn.outerWidth()).css('text-align','center').html("Buscar")}
$(".itemFound",jqoChooseCultura).slideUp();if(!isTroca){varieId=!1;$(".moreInfo").slideUp()}
else{trocaVarieId=!1}};var _searchVariedade=function(){_isLoading=!0;_disableVariedade(!0);jqoWarning.hide();$.post("ajax.newauction.php",{action:'searchVariedade',variedade:jqoVariedInp.val(),},function(ret){$("#debug").html(ret);ret=$.parseJSON(ret.substr(ret.indexOf("JSON=")+5));if(typeof ret=='object'){if(ret.error){jqoWarning.html(ret.error).fadeIn(function(){_isLoading=!1;_disableVariedade(!1)});return!1}
if(isTroca){trocaVarieId=ret.id}
else{varieId=ret.id}
jqoVariedInp.val(ret.variedade);$(".itemFound .txtCultura",jqoChooseCultura).html(ret.cultura);$(".itemFound .txtTecnologia",jqoChooseCultura).html(ret.tecnologia);$(".itemFound",jqoChooseCultura).slideDown(function(){if(!isTroca){$(".moreInfo").slideDown(function(){_isLoading=!1})}
else{_isLoading=!1}});jqoSearchBtn.css('width','').html("alterar")}});return!0};jqoVariedInp.on('change',_delayedSearch);jqoSearchBtn.click(function(){if(_isLoading){return!1}
if(isTroca){if(trocaVarieId){trocaVarieId=!1;_disableVariedade(!1);return!1}}
else{if(varieId){varieId=!1;_disableVariedade(!1);return!1}}
_delayedSearch();return!1})};_initChooseCultura($(".chooseCultura.initial"),!1);_initChooseCultura($(".chooseCultura.onTroca"),!0);var _doCreate=function(){if(_isLoading){return!1}
_isLoading=!0;if(!confirm("Você revisou os dados?\nNão será possível alterar após a confirmação.")){_isLoading=!1;return!1}
var theForm=jqoForm.serializeArray();$(".moreInfo").find("select,input").prop('disabled',!0).css('background-color','#CCC');jqoConfirmBtn.html("<i class='fa fa-spinner fa-spin'></i>");$.post("ajax.newauction.php",{action:'doCreate',varie_id:varieId,troca_id:trocaVarieId,theform:theForm,},function(ret){if(ret!='OK'){jqoWarningBox.addClass('error').html('<div><img src="images/icon-red-failed.png" /></div>'+'<span>'+(ret)+'</span>').slideDown(function(){$(".moreInfo").find("select,input").prop('disabled',!1).css('background-color','');jqoConfirmBtn.html("Confirmar Anúncio");_isLoading=!1});return!1}
jqoWarningBox.addClass('success').html('<div><img src="images/icon-green-checked.png" /></div>'+'<span>Sucesso!<br /><i class="fa fa-spinner fa-spin"></i> Carregando...</span>').slideDown(function(){location.href='newauction.php?show=sucesso'})})};jqoConfirmBtn.click(_doCreate);jqoForm.submit(function(){if(!varieId){_searchVariedade();return!1}
_doCreate();return!1});$("input[name=valor_por_kg],input[name=valor_royalties]",jqoForm).blur(function(){var curVal=$(this).val();var newVal=curVal?dHelper2.moeda(curVal):!1;$(this).val(newVal?newVal:'')});var _jqoTratInd=jqoForm.find("select[name='tratam_indust']");var _tratRefresh=function(setFocus){var needTexto=(_jqoTratInd.val()=='Sim');needTexto?jqoForm.find(".txtTratamento").slideDown(function(){if(setFocus){$(".txtTratamento input").focus()}}):jqoForm.find(".txtTratamento").slideUp();$(".txtTratamento input").prop('disabled',!needTexto);return needTexto};_tratRefresh();_jqoTratInd.change(function(){_tratRefresh(!0)});if(copyFrom){$(".chooseCultura.initial input").val(copyFrom.variedade);$(".chooseCultura.initial .actionBtn a").click();$.each(copyFrom,function(key,value){$(".novoAnuncio [name="+key+"]").val(value);_tratRefresh(!1);_embRefresh()});if(copyFrom.trocaVariedade){$(".chooseCultura.onTroca .inpCultivar").val(copyFrom.trocaVariedade);$(".chooseCultura.onTroca .actionBtn a").click()}}});$(function(){if('options' in document.createElement('datalist')){return!1}
var cultivList=[];$("#cultivarList option").each(function(){cultivList.push($(this).attr('value'))});$("input[list=cultivarList]").each(function(){var jqoInput=$(this);var jqoDlHolder=$("<div class='dataListHolder'></div>");var jqoOptions=$("<div class='dataListSimulator'></div>");jqoInput.removeAttr('list');jqoInput.wrap(jqoDlHolder);jqoOptions.hide().insertAfter(jqoInput);var _lastStr="";var _chooseOption=function(){jqoInput.val(this.innerHTML);jqoOptions.hide();jqoInput.change()};var _refreshOptions=function(){if(jqoInput.prop('readonly')){jqoOptions.hide();return!1}
var filterBy=$.trim(jqoInput.val()).toUpperCase();if(_lastStr==filterBy){return}
_lastStr=filterBy;if(filterBy.length<3){jqoOptions.hide();return}
filterBy=filterBy.split(" ");var _sofFilterBy=filterBy.length;var _foundAny=!1;jqoOptions.empty();for(var i=0;i<cultivList.length;i++){var _found=0;for(var k=0;k<filterBy.length;k++){if(cultivList[i].match("( |^)"+filterBy[k])){_found++}}
if(_found==_sofFilterBy){_foundAny=!0;var _jqoRow=$("<a>"+cultivList[i]+"</a>");jqoOptions.append(_jqoRow)}}
_foundAny?jqoOptions.show():jqoOptions.hide()};jqoOptions.bind('click',function(ev){var jqoTarget=$(ev.target);if(!jqoTarget.is('a')){return!1}
_chooseOption.call(ev.target);return!1});jqoInput.keyup(function(){_refreshOptions()});jqoInput.focus(_refreshOptions)})})