!function(t){var a=!1,e=!1,o=function(a,e,o,r){if(!s(a)){var i={};a.data("dSmartMap",i);var n=t("area",a);n.each(function(){var e=t(t(this).attr("coords").split(/, */)).map(function(){return parseInt(this)});t(this).data("dSmartMap",{jqoMap:a,offset:{left:e[0],top:e[1]},size:{w:e[2]-e[0]+1,h:e[3]-e[1]+1}}).mouseout(c).mouseover(u)});var d=t("img[usemap='#"+a.attr("name")+"']").first(),f=t("<img border='0' />").attr("border","0"),p=f.clone();i.isLoaded=!1,d.width()&&d.height()?(f.css("width",d[0].width),p.css("width",d[0].width),f.css("height",d[0].height),p.css("height",d[0].height),i.isLoaded=!0):f.load(function(){for(f.css("width",f[0].width),p.css("width",f[0].width),f.css("height",f[0].height),p.css("height",f[0].height),f.off("load"),i.isLoaded=!0;i.cbOnLoad.length;)i.cbOnLoad.shift()()}),f.attr("src",e),p.attr("src",o?o:e),i.cbOnLoad=[],i.jqoImgOver=f,i.jqoImgSel=p,i.autoInitImages=r}},r=function(e){if(s(e)){t("area",e).removeData("dSmartMap").off("mouseover",u).off("mouseout",c);e.data("dSmartMap");a&&a.jqoMap.is(e)&&j(),t("img[usemap='#"+e.attr("name")+"']").dSmartMap("destroy"),e.removeData("dSmartMap")}},i=function(a){if(!s(a)){var o={};a.data("dSmartMap",o),"inline"==a.css("display")&&a.css("display","inline-block"),o.jqoMap=t("map[name='"+a.attr("usemap").substr(1)+"']").first(),o.jqoSel=new t,o.jqoDiv=t("<div>").css("display",a.css("display")).css("position","relative").css("z-index",9).insertBefore(a).append(a),t.browser.msie&&o.jqoDiv.append(o.jqoMap.data("dSmartMap").jqoImgSel.clone().css("display","none")).append(o.jqoMap.data("dSmartMap").jqoImgOver.clone().css("display","none")),e?e=e.add(a):(e=a,f(!0))}},n=function(t){if(s(t)){var o=t.data("dSmartMap");o.jqoMap.data("dSmartMap");a&&a.jqoImg.is(t)&&j(t),o.jqoSel.remove();var r=o.jqoDiv;t.insertAfter(r),r.remove(),t.removeData("dSmartMap"),e=e.not(t),e.length||(e=!1,f(!1))}},s=function(t){return!!t.data("dSmartMap")},d=function(t,a){var e=t.data("dSmartMap");return e.isLoaded?(a(),!1):(e.cbOnLoad.push(a),!0)},f=function(a){a?t(window).on("resize",v):t(window).off("resize",v)},p=function(t,a,e){a.trigger("dSmartMap.mouseover")},m=function(t,a,e){a.trigger("dSmartMap.mouseout"),j()},u=function(a){if(/iPad|iPhone|iPod/.test(navigator.platform))return!1;var e=t(a.target),o=M(e,a);return o?(g(o,e),void p(a,e,"areaOver")):!1},c=function(e){t(e.toElement).closest("div").is(a.jqoOver)||m(e,t(e.target),"areaOut")},h=function(e){var o=t(this);if(s(o)){var r=o.data("dSmartMap");o.stop().animate({opacity:1}),a&&j(),a={jqoOver:o,jqoMap:r.jqoMap,jqoImg:r.jqoImg,jqoArea:r.jqoArea},"AREA"==e.relatedTarget.tagName||p(e,a.jqoArea,"hlOver")}},l=function(t){a.jqoArea&&m(t,a.jqoArea,"hlOut")},v=function(){t(e).each(function(){var a=t(this),e=t(this).data("dSmartMap").jqoSel;e.each(function(){var e=t(this).data("dSmartMap").jqoArea;a.dSmartMap(!1).dSmartMap(e)})})},g=function(e,o,r){if(!s(o))return!1;var n=o.data("dSmartMap"),d=n.jqoMap,f=n.jqoMap.data("dSmartMap"),u=e.data("dSmartMap");if(u||f.autoInitImages){if(!u)return i(e),g(e,o,r);a&&j();var c=t("<a>").append(r?f.jqoImgSel.clone():f.jqoImgOver.clone()).attr("href",o.attr("href")).attr("target",o.attr("target")).bind("click",function(t){return o.trigger("click",t),!1}),v=t("<div>").appendTo(u.jqoDiv).append(c).css("overflow","hidden").css("width",n.size.w).css("height",n.size.h).css("left",n.offset.left).css("top",n.offset.top).css("opacity",.01).show().css("position","absolute").scrollLeft(n.offset.left).scrollTop(n.offset.top);if(r){v.css("z-index",11).data("dSmartMap",{jqoImg:e,jqoMap:d,jqoArea:o}).css("opacity",.01).animate({opacity:1},"fast").mouseover(function(t){p(t,o,"permSel.mouseOver")}).mouseout(function(t){m(t,o,"permSel.mouseOut")});u.jqoSel.length;u.jqoSel=u.jqoSel.add(v)}else v.css("z-index",10).mouseout(l).mouseover(h).animate({opacity:1},"fast",function(){t(this).data("dSmartMap",{jqoImg:e,jqoMap:d,jqoArea:o})}),a={jqoOver:v,jqoMap:d,jqoImg:e,jqoArea:o}}},j=function(e,o){if(!e)return void(a&&(a.jqoOver.animate({opacity:.1},function(){t(this).remove()}),a=!1));var r=e.data("dSmartMap");return o&&o.length?r.jqoSel.length&&r.jqoSel.each(function(){return s(t(this))&&t(this).data("dSmartMap").jqoArea.is(o)?(r.jqoSel=r.jqoSel.not(t(this)),t(this).remove(),!1):void 0}):(r.jqoSel.remove(),r.jqoSel=new t),!1},q=function(t,a){if(a){var e=a.data("dSmartMap").jqoMap;e.data("dSmartMap");g(t,a,!0)}else j(t);return!1},M=function(a,e){var o=e.relatedTarget;if(o&&"IMG"==o.tagName){var r=t(o);if(r.attr("usemap")=="#"+a.closest("map").attr("name")&&s(r))return r}var i=!1;return t("img[usemap='#"+a.closest("map").attr("name")+"']").each(function(){var a=t(this).offset();return e.pageX>=a.left&&e.pageX<=a.left+t(this).width()&&e.pageY>=a.top&&e.pageY<=a.top+t(this).height()?(i=t(this),!1):void 0}),i};t.fn.dSmartMap=function(a,e,f,p){return t(this).each(function(){var m=this,u=t(m);if("IMG"==m.tagName){if(!u.attr("usemap"))return;var c=t("map[name='"+u.attr("usemap").substr(1)+"']").first();if("string"==typeof a){if("destroy"==a){if(!s(u))return;return void n(u)}o(c,a,e,!1),i(u),"boolean"==typeof f?u.dSmartMap(f):"function"==typeof f&&c.dSmartMap(f),"function"==typeof p&&c.dSmartMap(p)}if("object"==typeof a){var h=c.data("dSmartMap").autoInitImages;if(!s(u)){if(!h)return;i(u)}var l=a,v="undefined"==typeof e?!0:e,g="undefined"==typeof f?!1:f;d(c,function(){v?(g||j(u),q(u,l)):j(u,l)})}if("boolean"==typeof a&&!a){if(!s(u)){if(!s(c))return;var h=c.data("dSmartMap").autoInitImages;if(!h)return;i(u)}d(c,function(){q(u,!1)})}}if("MAP"==m.tagName){var M=t("img[usemap='#"+u.attr("name")+"']");if("string"==typeof a){if("destroy"==a){if(!s(u))return;return void r(u)}s(u)&&r(u),o(u,a,e,!0)}("object"==typeof a||"boolean"==typeof a)&&M.dSmartMap(a)}if("AREA"==m.tagName){if("object"==typeof a){var M=a;a="undefined"==typeof e?!0:e,e="undefined"==typeof f?!1:f}else{var M=t("img[usemap='#"+u.closest("map").attr("name")+"']");a="undefined"==typeof a?!0:a,e="undefined"==typeof e?!1:e}M.dSmartMap(u,a,e)}}),this}}(jQuery);
